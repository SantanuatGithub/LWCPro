(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.WireService={})})(this,function(a){"use strict";function b(a,b){a.forEach(a=>{const{listener:c,statics:d,reactives:e}=a,f=Object.create(null);if(e){const a=Object.keys(e);for(let c=0,d=a.length;c<d;c++){const d=a[c],g=b[e[d]];f[d]=g}}const g=Object.assign({},d,f);c.call(void 0,g)})}function c(a,b,c){c.mutated||(c.mutated=new Set,Promise.resolve().then(d.bind(void 0,a,c))),c.mutated.add(b)}function d(a,c){const d=new Set,f=c.mutated;delete c.mutated;let g;f.forEach(b=>{const f=e(a,b);if(c.values[b.reference]!==f){c.values[b.reference]=f,g=c.listeners[b.head];for(let a=0,b=g.length;a<b;a++)d.add(g[a])}}),b(d,c.values)}function e(a,b){let c=a[b.head];if(!b.tail)return c;const d=b.tail;for(let e=0,f=d.length;e<f&&null!=c;e++){const a=d[e];if("object"!=typeof c||!(a in c))return;c=c[a]}return c}function f(a,b,d){const e=c.bind(void 0,a,b,d),f=h(a,b.head,e);Object.defineProperty(a,b.head,f)}function g(a,b,c){if(c=c||[],!a||-1<c.indexOf(a))return null;const d=Object.getOwnPropertyDescriptor(a,b);if(d)return d;const e=Object.getPrototypeOf(a);return e?(c.push(a),g(e,b,c)):null}function h(a,b,c){const d=g(a,b);let e,f,h;if(null===d||d.get===void 0&&d.set===void 0){let d=a[b];e=!0,f=function(){return d},h=function(a){d=a,c()}}else{const{set:b,get:g}=d;e=d.enumerable,h=function(d){b&&b.call(a,d),c()},f=function(){return g?g.call(a):void 0}}return{set:h,get:f,enumerable:e,configurable:!0}}function i(a,b){const c=a.indexOf(b);-1<c&&a.splice(c,1)}function j(a,b){for(let c=0,d=a.length;c<d;c++)if(a[c].listener===b)return void a.splice(c,1)}function k(a){if(!a.includes("."))return{reference:a,head:a};const b=a.split(".");return{reference:a,head:b.shift(),tail:b}}function l(a){for(let b=0,c=a.length;b<c;++b)a[b].call(void 0)}const m="updated",n="connected",o="disconnected",p="connect",q="disconnect",r="config";class s{constructor(a,b,c,d,e){this._cmp=a,this._def=b,this._context=c,this._wireDef=d,this._wireTarget=e}addEventListener(a,b){switch(a){case p:{const a=this._context["@wire"][n];a.push(b);break}case q:{const a=this._context["@wire"][o];a.push(b);break}case r:{const a=this._wireDef.params,d=this._wireDef.static;let e;if(!a||0===(e=Object.keys(a)).length){const a=d||Object.create(null);return void b.call(void 0,a)}const g={listener:b,statics:d,reactives:a},h=this._context["@wire"][m];e.forEach(b=>{const d=k(a[b]);let e=h.listeners[d.head];e?e.push(g):(e=[g],h.listeners[d.head]=e,f(this._cmp,d,h)),c(this._cmp,d,h)});break}default:throw new Error(`unsupported event type ${a}`);}}removeEventListener(a,b){switch(a){case p:{const a=this._context["@wire"][n];i(a,b);break}case q:{const a=this._context["@wire"][o];i(a,b);break}case r:{const a=this._context["@wire"][m].listeners,c=this._wireDef.params;c&&Object.keys(c).forEach(d=>{const e=k(c[d]),f=a[e.head];f&&j(f,b)});break}default:throw new Error(`unsupported event type ${a}`);}}dispatchEvent(a){if(a instanceof t){const b=a.value;return this._wireDef.method?this._cmp[this._wireTarget](b):this._cmp[this._wireTarget]=b,!1}if("WireContextEvent"===a.type)return this._cmp.dispatchEvent(a);throw new Error(`Invalid event ${a}.`)}}class t{constructor(a){this.type="ValueChangedEvent",this.value=a}}const u=new Map,v={wiring:(a,b,c,d)=>{const e=d["@wire"]=Object.create(null);e[n]=[],e[o]=[],e[m]={listeners:{},values:{}};const f=c.wire,g=Object.keys(f);for(let e=0,h=g.length;e<h;e++){const b=g[e],h=f[b],i=u.get(h.adapter);if(i){const e=new s(a,c,d,h,b);i({dispatchEvent:e.dispatchEvent.bind(e),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)})}}},connected:(a,b,c,d)=>{let e;c.wire&&(e=d["@wire"][n])&&l(e)},disconnected:(a,b,c,d)=>{let e;c.wire&&(e=d["@wire"][o])&&l(e)}};a.registerWireService=function(a){a(v)},a.register=function(a,b){u.set(a,b)},a.ValueChangedEvent=t,Object.defineProperty(a,"__esModule",{value:!0})});

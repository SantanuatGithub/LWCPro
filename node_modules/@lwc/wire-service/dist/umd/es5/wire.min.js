(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.WireService={})})(this,function(a){"use strict";function b(a,b){a.forEach(function(a){var c=a.listener,d=a.statics,e=a.reactives,f=Object.create(null);if(e)for(var g=Object.keys(e),h=0,i=g.length;h<i;h++){var k=g[h],l=b[e[k]];f[k]=l}var m=Object.assign({},d,f);c.call(void 0,m)})}function c(a,b,c){c.mutated||(c.mutated=new Set,Promise.resolve().then(d.bind(void 0,a,c))),c.mutated.add(b)}function d(a,c){var d=new Set,f=c.mutated;delete c.mutated;var g;f.forEach(function(b){var f=e(a,b);if(c.values[b.reference]!==f){c.values[b.reference]=f,g=c.listeners[b.head];for(var h=0,j=g.length;h<j;h++)d.add(g[h])}}),b(d,c.values)}function e(a,b){var c=a[b.head];if(!b.tail)return c;for(var d,e=b.tail,f=0,g=e.length;f<g&&null!=c;f++){if(d=e[f],"object"!=typeof c||!(d in c))return;c=c[d]}return c}function f(a,b,d){var e=c.bind(void 0,a,b,d),f=h(a,b.head,e);Object.defineProperty(a,b.head,f)}function g(a,b,c){if(c=c||[],!a||-1<c.indexOf(a))return null;var d=Object.getOwnPropertyDescriptor(a,b);if(d)return d;var e=Object.getPrototypeOf(a);return e?(c.push(a),g(e,b,c)):null}function h(a,b,c){var d,e,f,h=g(a,b);if(null===h||h.get===void 0&&h.set===void 0){var i=a[b];d=!0,e=function(){return i},f=function(a){i=a,c()}}else{var j=h.set,k=h.get;d=h.enumerable,f=function(b){j&&j.call(a,b),c()},e=function(){return k?k.call(a):void 0}}return{set:f,get:e,enumerable:d,configurable:!0}}function i(a,b){var c=a.indexOf(b);-1<c&&a.splice(c,1)}function j(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c].listener===b)return void a.splice(c,1)}function k(a){if(!a.includes("."))return{reference:a,head:a};var b=a.split(".");return{reference:a,head:b.shift(),tail:b}}function l(a){for(var b=0,c=a.length;b<c;++b)a[b].call(void 0)}var m="updated",n="connected",o="disconnected",p="connect",q="disconnect",r="config",s=function(){function a(a,b,c,d,e){this._cmp=a,this._def=b,this._context=c,this._wireDef=d,this._wireTarget=e}return a.prototype.addEventListener=function(a,b){var d=this;switch(a){case p:{var e=this._context["@wire"][n];e.push(b);break}case q:{var g=this._context["@wire"][o];g.push(b);break}case r:{var h=this._wireDef.params,i=this._wireDef.static,j=void 0;if(!h||0===(j=Object.keys(h)).length){var l=i||Object.create(null);return void b.call(void 0,l)}var s={listener:b,statics:i,reactives:h},t=this._context["@wire"][m];j.forEach(function(a){var b=k(h[a]),e=t.listeners[b.head];e?e.push(s):(e=[s],t.listeners[b.head]=e,f(d._cmp,b,t)),c(d._cmp,b,t)});break}default:throw new Error("unsupported event type "+a);}},a.prototype.removeEventListener=function(a,b){switch(a){case p:{var c=this._context["@wire"][n];i(c,b);break}case q:{var d=this._context["@wire"][o];i(d,b);break}case r:{var e=this._context["@wire"][m].listeners,f=this._wireDef.params;f&&Object.keys(f).forEach(function(a){var c=k(f[a]),d=e[c.head];d&&j(d,b)});break}default:throw new Error("unsupported event type "+a);}},a.prototype.dispatchEvent=function(a){if(a instanceof t){var b=a.value;return this._wireDef.method?this._cmp[this._wireTarget](b):this._cmp[this._wireTarget]=b,!1}if("WireContextEvent"===a.type)return this._cmp.dispatchEvent(a);throw new Error("Invalid event "+a+".")},a}(),t=function(){return function(a){this.type="ValueChangedEvent",this.value=a}}(),u=new Map,v={wiring:function(a,b,c,d){var e=d["@wire"]=Object.create(null);e[n]=[],e[o]=[],e[m]={listeners:{},values:{}};for(var f=c.wire,g=Object.keys(f),h=function(b){var e=g[b],h=f[e],i=u.get(h.adapter);if(i){var j=new s(a,c,d,h,e);i({dispatchEvent:j.dispatchEvent.bind(j),addEventListener:j.addEventListener.bind(j),removeEventListener:j.removeEventListener.bind(j)})}},j=0,k=g.length;j<k;j++)h(j,k)},connected:function(a,b,c,d){var e;c.wire&&(e=d["@wire"][n])&&l(e)},disconnected:function(a,b,c,d){var e;c.wire&&(e=d["@wire"][o])&&l(e)}};a.registerWireService=function(a){a(v)},a.register=function(a,b){u.set(a,b)},a.ValueChangedEvent=t,Object.defineProperty(a,"__esModule",{value:!0})});
